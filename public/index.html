<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <meta name="theme-color" content="#6f42c1" />
    <meta name="description" content="Pi Lottery - Provably Fair Lotteries with 2% Ticket System" />
    
    <!-- Pi Browser Compatibility -->
    <meta name="pi-network-app" content="true" />
    <meta name="pi-app-version" content="2.0.0" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    
    <title>Pi Lottery - Fair & Transparent</title>
    
    <!-- Pi SDK Configuration -->
    <script>
      // Simple Pi SDK status tracking
      window.piSDKStatus = {
        loaded: false,
        startTime: Date.now()
      };
      
      // Check Pi SDK availability
      window.checkPiSDK = function() {
        if (window.Pi) {
          window.piSDKStatus.loaded = true;
          
          // Notify React app
          window.dispatchEvent(new CustomEvent('piSDKReady', {
            detail: {
              loadTime: Date.now() - window.piSDKStatus.startTime
            }
          }));
        } else {
          // Retry in 1 second if not found
          setTimeout(window.checkPiSDK, 1000);
        }
      };
      
      // SDK Loading Handler
      window.handlePiSDKLoad = function() {
        setTimeout(window.checkPiSDK, 500);
      };
      
      // Page Load Handler
      window.addEventListener('load', function() {
        setTimeout(function() {
          if (!window.piSDKStatus.loaded) {
            window.checkPiSDK();
          }
        }, 2000);
      });
    </script>
    
    <!-- Loading Screen Styles -->
    <style>
      #initial-loading {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, #6f42c1, #8b5cf6);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        z-index: 1000;
        color: white;
        text-align: center;
      }
      
      .loading-spinner {
        width: 60px;
        height: 60px;
        border: 6px solid rgba(255,255,255,0.3);
        border-top: 6px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 30px;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      .loading-progress {
        width: 300px;
        height: 4px;
        background: rgba(255,255,255,0.3);
        border-radius: 2px;
        overflow: hidden;
        margin-top: 20px;
      }
      
      .loading-progress-bar {
        height: 100%;
        background: white;
        border-radius: 2px;
        animation: loadingProgress 3s ease-in-out infinite;
      }
      
      @keyframes loadingProgress {
        0% { width: 0%; }
        50% { width: 70%; }
        100% { width: 100%; }
      }
      
      /* Responsive Design */
      @media (max-width: 768px) {
        #initial-loading {
          padding: 20px;
        }
        
        .loading-spinner {
          width: 50px;
          height: 50px;
          border-width: 5px;
        }
        
        .loading-progress {
          width: 250px;
        }
      }
    </style>
  </head>
  
  <body>
    <noscript>
      <div style="
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        text-align: center;
        padding: 20px;
        font-family: Arial, sans-serif;
        background: #f8f9fa;
      ">
        <h2 style="color: #dc3545; margin-bottom: 20px;">ðŸš« JavaScript Required</h2>
        <p style="color: #6c757d; max-width: 400px; line-height: 1.6;">
          Pi Lottery requires JavaScript to function properly. Please enable JavaScript in your browser settings and refresh this page.
        </p>
      </div>
    </noscript>
    
    <!-- Loading Screen -->
    <div id="initial-loading">
      <div class="loading-spinner"></div>
      <h2 style="margin: 0 0 10px 0; font-size: 2rem;">ðŸŽ° Pi Lottery</h2>
      <p style="margin: 0 0 20px 0; font-size: 1.1rem; opacity: 0.9;">
        Provably Fair Lotteries
      </p>
      
      <div id="loading-status" style="font-size: 16px; font-weight: 500;">
        Connecting to Pi Network...
      </div>
      
      <div class="loading-progress">
        <div class="loading-progress-bar"></div>
      </div>
    </div>
    
    <!-- Main app container -->
    <div id="root"></div>
    
    <!-- Pi SDK Loading -->
    <script 
      src="https://sdk.minepi.com/pi-sdk.js" 
      onload="window.handlePiSDKLoad()"
      async
    ></script>
    
    <!-- Loading Management -->
    <script>
      // Monitor app mounting
      const rootObserver = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
            const root = document.getElementById('root');
            if (root && root.children.length > 0) {
              // Hide loading screen
              const loading = document.getElementById('initial-loading');
              if (loading) {
                loading.style.opacity = '0';
                loading.style.transition = 'opacity 0.5s ease';
                setTimeout(() => {
                  loading.style.display = 'none';
                }, 500);
              }
              
              rootObserver.disconnect();
            }
          }
        });
      });
      
      rootObserver.observe(document.getElementById('root'), {
        childList: true,
        subtree: true
      });
      
      // Auto-hide loading after maximum time
      setTimeout(() => {
        const loading = document.getElementById('initial-loading');
        if (loading && loading.style.display !== 'none') {
          loading.style.display = 'none';
        }
      }, 15000);
    </script>
  </body>
</html>
